#!/bin/bash

read -r -d '' WAYPOINTS << 'EOF'
  Step 1: [2.5        0.92372815 2.2        1.        ]
  Step 2: [2.56261012 1.10089052 2.09919367 0.82274122]
  Step 3: [2.61009109 1.27975909 1.96354669 0.7027594 ]
  Step 4: [2.62605788 1.4621817  1.75532632 0.70208602]
  Step 5: [2.67383519 1.62662155 1.5459715  0.68802876]
  Step 6: [2.80059659 1.76415642 1.35327447 0.66890459]
  Step 7: [2.94323221 1.95250899 1.22562909 0.73799996]
  Step 8: [3.17230797 1.92648979 1.29800869 0.83176558]
  Step 9: [3.39193434 1.88086613 1.39736432 0.93730818]
  Step 10: [3.42020647 1.84496842 1.57990852 1.11223573]
  Step 11: [3.55212626 1.73004517 1.79429874 1.13000577]
  Step 12: [3.68627438 1.59335769 1.9632807  1.09599717]
  Step 13: [3.82490277 1.41291135 2.04096543 0.9578831 ]
  Step 14: [3.87476835 1.1835443  2.12005618 0.94189395]
  Step 15: [3.87078006 0.92449625 2.2        1.        ]
  Step 1: [3.92701957 0.91591986 2.2        1.        ]
  Step 2: [3.86715321 1.1026073  2.01439763 1.07581798]
  Step 3: [3.7906417  1.28591386 1.9055509  1.17325119]
  Step 4: [3.67503635 1.45546699 1.98729552 1.32673745]
  Step 5: [3.67882128 1.52469681 1.73962339 1.43847023]
  Step 6: [3.6500197  1.67792382 1.57110664 1.56927342]
  Step 7: [3.52976693 1.84824635 1.49272665 1.6216442 ]
  Step 8: [3.29263749 1.9647674  1.48386815 1.52811994]
  Step 9: [3.02057986 1.96684244 1.51596601 1.46866632]
  Step 10: [2.86680726 1.85059138 1.57207943 1.33484767]
  Step 11: [2.7840057  1.66359582 1.6425214  1.15638961]
  Step 12: [2.66833606 1.55514332 1.84385484 1.19074338]
  Step 13: [2.60399578 1.37306053 2.02360275 1.1887338 ]
  Step 14: [2.56828834 1.14723385 2.18134967 1.15031524]
  Step 15: [2.5        0.92372815 2.2        1.        ]
    Step 1: [2.5        0.92372815 2.2        1.        ]
  Step 2: [2.56261012 1.10089052 2.09919367 0.82274122]
  Step 3: [2.61009109 1.27975909 1.96354669 0.7027594 ]
  Step 4: [2.62605788 1.4621817  1.75532632 0.70208602]
  Step 5: [2.67383519 1.62662155 1.5459715  0.68802876]
  Step 6: [2.80059659 1.76415642 1.35327447 0.66890459]
  Step 7: [2.94323221 1.95250899 1.22562909 0.73799996]
  Step 8: [3.17230797 1.92648979 1.29800869 0.83176558]
  Step 9: [3.39193434 1.88086613 1.39736432 0.93730818]
  Step 10: [3.42020647 1.84496842 1.57990852 1.11223573]
  Step 11: [3.55212626 1.73004517 1.79429874 1.13000577]
  Step 12: [3.68627438 1.59335769 1.9632807  1.09599717]
  Step 13: [3.82490277 1.41291135 2.04096543 0.9578831 ]
  Step 14: [3.87476835 1.1835443  2.12005618 0.94189395]
  Step 15: [3.87078006 0.92449625 2.2        1.        ]
  Step 1: [3.92701957 0.91591986 2.2        1.        ]
  Step 2: [3.86715321 1.1026073  2.01439763 1.07581798]
  Step 3: [3.7906417  1.28591386 1.9055509  1.17325119]
  Step 4: [3.67503635 1.45546699 1.98729552 1.32673745]
  Step 5: [3.67882128 1.52469681 1.73962339 1.43847023]
  Step 6: [3.6500197  1.67792382 1.57110664 1.56927342]
  Step 7: [3.52976693 1.84824635 1.49272665 1.6216442 ]
  Step 8: [3.29263749 1.9647674  1.48386815 1.52811994]
  Step 9: [3.02057986 1.96684244 1.51596601 1.46866632]
  Step 10: [2.86680726 1.85059138 1.57207943 1.33484767]
  Step 11: [2.7840057  1.66359582 1.6425214  1.15638961]
  Step 12: [2.66833606 1.55514332 1.84385484 1.19074338]
  Step 13: [2.60399578 1.37306053 2.02360275 1.1887338 ]
  Step 14: [2.56828834 1.14723385 2.18134967 1.15031524]
  Step 15: [2.5        0.92372815 2.2        1.        ]
    Step 1: [2.5        0.92372815 2.2        1.        ]
  Step 2: [2.56261012 1.10089052 2.09919367 0.82274122]
  Step 3: [2.61009109 1.27975909 1.96354669 0.7027594 ]
  Step 4: [2.62605788 1.4621817  1.75532632 0.70208602]
  Step 5: [2.67383519 1.62662155 1.5459715  0.68802876]
  Step 6: [2.80059659 1.76415642 1.35327447 0.66890459]
  Step 7: [2.94323221 1.95250899 1.22562909 0.73799996]
  Step 8: [3.17230797 1.92648979 1.29800869 0.83176558]
  Step 9: [3.39193434 1.88086613 1.39736432 0.93730818]
  Step 10: [3.42020647 1.84496842 1.57990852 1.11223573]
  Step 11: [3.55212626 1.73004517 1.79429874 1.13000577]
  Step 12: [3.68627438 1.59335769 1.9632807  1.09599717]
  Step 13: [3.82490277 1.41291135 2.04096543 0.9578831 ]
  Step 14: [3.87476835 1.1835443  2.12005618 0.94189395]
  Step 15: [3.87078006 0.92449625 2.2        1.        ]
  Step 1: [3.92701957 0.91591986 2.2        1.        ]
  Step 2: [3.86715321 1.1026073  2.01439763 1.07581798]
  Step 3: [3.7906417  1.28591386 1.9055509  1.17325119]
  Step 4: [3.67503635 1.45546699 1.98729552 1.32673745]
  Step 5: [3.67882128 1.52469681 1.73962339 1.43847023]
  Step 6: [3.6500197  1.67792382 1.57110664 1.56927342]
  Step 7: [3.52976693 1.84824635 1.49272665 1.6216442 ]
  Step 8: [3.29263749 1.9647674  1.48386815 1.52811994]
  Step 9: [3.02057986 1.96684244 1.51596601 1.46866632]
  Step 10: [2.86680726 1.85059138 1.57207943 1.33484767]
  Step 11: [2.7840057  1.66359582 1.6425214  1.15638961]
  Step 12: [2.66833606 1.55514332 1.84385484 1.19074338]
  Step 13: [2.60399578 1.37306053 2.02360275 1.1887338 ]
  Step 14: [2.56828834 1.14723385 2.18134967 1.15031524]
  Step 15: [2.5        0.92372815 2.2        1.        ]
EOF

while IFS= read -r line; do
  [[ -z "$line" ]] && continue

  echo "Processing: $line"

  numbers=$(echo "$line" | sed -n 's/.*\[\(.*\)\].*/\1/p')

  read -ra vals <<< "$numbers"

  if [[ ${#vals[@]} -ne 4 ]]; then
    echo "Warning: Expected 4 numbers but got ${#vals[@]} in line: $line"
    continue
  fi

  reversed=()
  for (( i=${#vals[@]}-1; i>=0; i-- )); do
    reversed+=( "${vals[i]}" )
  done

  positions="0.0"
  for num in "${reversed[@]}"; do
    positions+=", ${num}"
  done

  echo "Publishing waypoint with positions: [${positions}]"

  message="joint_names:
- 'axis_a'
- 'axis_b'
- 'axis_c'
- 'axis_d'
- 'axis_e'
points:
- positions: [${positions}]
  time_from_start:
    sec: 2
    nanosec: 0"

  ros2 topic pub /xsubsea/joint_trajectory trajectory_msgs/msg/JointTrajectory "$message" -1

  sleep 1

done <<< "$WAYPOINTS"
